###########################################################
# Automation: [System] Update Available
###########################################################

- alias: "[System] Update Available"
  hide_entity: true
  trigger:
    - platform: state
      entity_id: updater.updater
  condition:
    - condition: template
      value_template: "{{ states('updater.updater') != 'unknown' }}"
  action:
    - service: persistent_notification.create
      data:
        title: Update Available
        message: "Home Assistant {{ states('updater.updater') }} is available. You are currently running {{ states('sensor.ha_version') }}"
        notification_id: update_available
    - service: notify.join_user1
      data_template:
        title: Update Available
        message: "Home Assistant {{ states('updater.updater') }} is available. You are currently running {{ states('sensor.ha_version') }}"
        data:
          icon: "https://raw.githubusercontent.com/zanix/home-assistant-config/master/www/icons/update.png"
          smallicon: "https://raw.githubusercontent.com/zanix/home-assistant-config/master/www/icons/home-assistant.png"
          url: "{{ state_attr('updater.updater', 'release_notes') }}"
